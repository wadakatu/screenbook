import{createComponent as m,isServer as A,getRequestEvent as $,delegateEvents as M,spread as N,useAssets as B,ssr as V,escape as x}from"solid-js/web";import{children as W,createMemo as O,getOwner as D,untrack as H,Show as q,on as J,createRoot as _,createSignal as z,onCleanup as P,sharedConfig as R,createContext as G,createUniqueId as Q,useContext as X,createRenderEffect as Y,Suspense as Z}from"solid-js";import{F as ee}from"./server-fns-CVU_Pb27.js";import{d as te,e as re,R as ne,g as oe,f as ae,h as j,i as ie,m as se,j as ce,k as ue,s as le,l as de}from"./routing-DDvTknO6.js";import"cookie-es";import"seroval";import"seroval-plugins/web";import"solid-js/web/storage";import"h3";import"unctx";import"node:async_hooks";import"radix3";const I=e=>t=>{const{base:r}=t,o=W(()=>t.children),n=O(()=>te(o(),t.base||""));let a;const i=re(e,n,()=>a,{base:r,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return e.create&&e.create(i),m(ne.Provider,{value:i,get children(){return m(fe,{routerState:i,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[(a=D())&&null,m(he,{routerState:i,get branches(){return n()}})]}})}})};function fe(e){const t=e.routerState.location,r=e.routerState.params,o=O(()=>e.preload&&H(()=>{e.preload({params:r,location:t,intent:oe()||"initial"})}));return m(q,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:n=>m(n,{params:r,location:t,get data(){return o()},get children(){return e.children}})})}function he(e){if(A){const n=$();if(n&&n.router&&n.router.dataOnly){me(n,e.routerState,e.branches);return}n&&((n.router||(n.router={})).matches||(n.router.matches=e.routerState.matches().map(({route:a,path:i,params:u})=>({path:a.originalPath,pattern:a.pattern,match:i,params:u,info:a.info}))))}const t=[];let r;const o=O(J(e.routerState.matches,(n,a,i)=>{let u=a&&n.length===a.length;const h=[];for(let l=0,p=n.length;l<p;l++){const w=a&&a[l],g=n[l];i&&w&&g.route.key===w.route.key?h[l]=i[l]:(u=!1,t[l]&&t[l](),_(y=>{t[l]=y,h[l]=ae(e.routerState,h[l-1]||e.routerState.base,U(()=>o()[l+1]),()=>{const b=e.routerState.matches();return b[l]??b[0]})}))}return t.splice(n.length).forEach(l=>l()),i&&u?i:(r=h[0],h)}));return U(()=>o()&&r)()}const U=e=>()=>m(q,{get when(){return e()},keyed:!0,children:t=>m(ie.Provider,{value:t,get children(){return t.outlet()}})});function me(e,t,r){const o=new URL(e.request.url),n=j(r,new URL(e.router.previousUrl||e.request.url).pathname),a=j(r,o.pathname);for(let i=0;i<a.length;i++){(!n[i]||a[i].route!==n[i].route)&&(e.router.dataOnly=!0);const{route:u,params:h}=a[i];u.preload&&u.preload({params:h,location:t.location,intent:"preload"})}}function pe([e,t],r,o){return[e,o?n=>t(o(n)):t]}function ge(e){let t=!1;const r=n=>typeof n=="string"?{value:n}:n,o=pe(z(r(e.get()),{equals:(n,a)=>n.value===a.value&&n.state===a.state}),void 0,n=>(!t&&e.set(n),R.registry&&!R.done&&(R.done=!0),n));return e.init&&P(e.init((n=e.get())=>{t=!0,o[1](r(n)),t=!1})),I({signal:o,create:e.create,utils:e.utils})}function we(e,t,r){return e.addEventListener(t,r),()=>e.removeEventListener(t,r)}function be(e,t){const r=e&&document.getElementById(e);r?r.scrollIntoView():t&&window.scrollTo(0,0)}function ve(e){const t=new URL(e);return t.pathname+t.search}function ye(e){let t;const r={value:e.url||(t=$())&&ve(t.request.url)||""};return I({signal:[()=>r,o=>Object.assign(r,o)]})(e)}const Se=new Map;function Re(e=!0,t=!1,r="/_server",o){return n=>{const a=n.base.path(),i=n.navigatorFactory(n.base);let u,h;function l(s){return s.namespaceURI==="http://www.w3.org/2000/svg"}function p(s){if(s.defaultPrevented||s.button!==0||s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)return;const c=s.composedPath().find(k=>k instanceof Node&&k.nodeName.toUpperCase()==="A");if(!c||t&&!c.hasAttribute("link"))return;const f=l(c),d=f?c.href.baseVal:c.href;if((f?c.target.baseVal:c.target)||!d&&!c.hasAttribute("state"))return;const v=(c.getAttribute("rel")||"").split(/\s+/);if(c.hasAttribute("download")||v&&v.includes("external"))return;const S=f?new URL(d,document.baseURI):new URL(d);if(!(S.origin!==window.location.origin||a&&S.pathname&&!S.pathname.toLowerCase().startsWith(a.toLowerCase())))return[c,S]}function w(s){const c=p(s);if(!c)return;const[f,d]=c,T=n.parsePath(d.pathname+d.search+d.hash),v=f.getAttribute("state");s.preventDefault(),i(T,{resolve:!1,replace:f.hasAttribute("replace"),scroll:!f.hasAttribute("noscroll"),state:v?JSON.parse(v):void 0})}function g(s){const c=p(s);if(!c)return;const[f,d]=c;o&&(d.pathname=o(d.pathname)),n.preloadRoute(d,f.getAttribute("preload")!=="false")}function y(s){clearTimeout(u);const c=p(s);if(!c)return h=null;const[f,d]=c;h!==f&&(o&&(d.pathname=o(d.pathname)),u=setTimeout(()=>{n.preloadRoute(d,f.getAttribute("preload")!=="false"),h=f},20))}function b(s){if(s.defaultPrevented)return;let c=s.submitter&&s.submitter.hasAttribute("formaction")?s.submitter.getAttribute("formaction"):s.target.getAttribute("action");if(!c)return;if(!c.startsWith("https://action/")){const d=new URL(c,se);if(c=n.parsePath(d.pathname+d.search),!c.startsWith(r))return}if(s.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const f=Se.get(c);if(f){s.preventDefault();const d=new FormData(s.target,s.submitter);f.call({r:n,f:s.target},s.target.enctype==="multipart/form-data"?d:new URLSearchParams(d))}}M(["click","submit"]),document.addEventListener("click",w),e&&(document.addEventListener("mousemove",y,{passive:!0}),document.addEventListener("focusin",g,{passive:!0}),document.addEventListener("touchstart",g,{passive:!0})),document.addEventListener("submit",b),P(()=>{document.removeEventListener("click",w),e&&(document.removeEventListener("mousemove",y),document.removeEventListener("focusin",g),document.removeEventListener("touchstart",g)),document.removeEventListener("submit",b)})}}function Ce(e){if(A)return ye(e);const t=()=>{const o=window.location.pathname.replace(/^\/+/,"/")+window.location.search,n=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:o+window.location.hash,state:n}},r=ce();return ge({get:t,set({value:o,replace:n,scroll:a,state:i}){n?window.history.replaceState(ue(i),"",o):window.history.pushState(i,"",o),be(decodeURIComponent(window.location.hash.slice(1)),a),le()},init:o=>we(window,"popstate",de(o,n=>{if(n)return!r.confirm(n);{const a=t();return!r.confirm(a.value,{state:a.state})}})),create:Re(e.preload,e.explicitLinks,e.actionBase,e.transformUrl),utils:{go:o=>window.history.go(o),beforeLeave:r}})(e)}const F=G(),K=["title","meta"],E=[],L=["name","http-equiv","content","charset","media"].concat(["property"]),C=(e,t)=>{const r=Object.fromEntries(Object.entries(e.props).filter(([o])=>t.includes(o)).sort());return(Object.hasOwn(r,"name")||Object.hasOwn(r,"property"))&&(r.name=r.name||r.property,delete r.property),e.tag+JSON.stringify(r)};function Ee(){if(!R.context){const r=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(r,o=>o.parentNode.removeChild(o))}const e=new Map;function t(r){if(r.ref)return r.ref;let o=document.querySelector(`[data-sm="${r.id}"]`);return o?(o.tagName.toLowerCase()!==r.tag&&(o.parentNode&&o.parentNode.removeChild(o),o=document.createElement(r.tag)),o.removeAttribute("data-sm")):o=document.createElement(r.tag),o}return{addTag(r){if(K.indexOf(r.tag)!==-1){const a=r.tag==="title"?E:L,i=C(r,a);e.has(i)||e.set(i,[]);let u=e.get(i),h=u.length;u=[...u,r],e.set(i,u);let l=t(r);r.ref=l,N(l,r.props);let p=null;for(var o=h-1;o>=0;o--)if(u[o]!=null){p=u[o];break}return l.parentNode!=document.head&&document.head.appendChild(l),p&&p.ref&&p.ref.parentNode&&document.head.removeChild(p.ref),h}let n=t(r);return r.ref=n,N(n,r.props),n.parentNode!=document.head&&document.head.appendChild(n),-1},removeTag(r,o){const n=r.tag==="title"?E:L,a=C(r,n);if(r.ref){const i=e.get(a);if(i){if(r.ref.parentNode){r.ref.parentNode.removeChild(r.ref);for(let u=o-1;u>=0;u--)i[u]!=null&&document.head.appendChild(i[u].ref)}i[o]=null,e.set(a,i)}else r.ref.parentNode&&r.ref.parentNode.removeChild(r.ref)}}}}function Le(){const e=[];return B(()=>V(Te(e))),{addTag(t){if(K.indexOf(t.tag)!==-1){const r=t.tag==="title"?E:L,o=C(t,r),n=e.findIndex(a=>a.tag===t.tag&&C(a,r)===o);n!==-1&&e.splice(n,1)}return e.push(t),e.length},removeTag(t,r){}}}const Ae=e=>{const t=A?Le():Ee();return m(F.Provider,{value:t,get children(){return e.children}})},Oe=(e,t,r)=>(Pe({tag:e,props:t,setting:r,id:Q(),get name(){return t.name||t.property}}),null);function Pe(e){const t=X(F);if(!t)throw new Error("<MetaProvider /> should be in the tree");Y(()=>{const r=t.addTag(e);P(()=>t.removeTag(e,r))})}function Te(e){return e.map(t=>{const o=Object.keys(t.props).map(a=>a==="children"?"":` ${a}="${x(t.props[a],!0)}"`).join("");let n=t.props.children;return Array.isArray(n)&&(n=n.join("")),t.setting?.close?`<${t.tag} data-sm="${t.id}"${o}>${t.setting?.escape?x(n):n||""}</${t.tag}>`:`<${t.tag} data-sm="${t.id}"${o}/>`}).join("")}const ke=e=>Oe("title",e,{escape:!0,close:!0});function We(){return m(Ce,{root:e=>m(Ae,{get children(){return[m(ke,{children:"SolidStart + Screenbook"}),m(Z,{get children(){return e.children}})]}}),get children(){return m(ee,{})}})}export{We as default};
